/**
 * <image.preview.js> [https://github.com/sixem/image.preview.js]
 * 
 * Licensed under MIT
 *
 * @author  emy [admin@eyy.co]
 */
 
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){t.fn.imagePreview=function(e){var i={loading:null,store:{},last:{},css:{required:{}}};i.settings=t.extend({hoverDelay:75,staticPreview:!1,windowMargin:4,triggerMargin:24,elements:[],extensions:{images:["jpg","jpeg","gif","png","ico","svg","bmp"],videos:["mp4","webm"]}},i.settings,e),i.css.required={"max-height":"calc(100% - "+2*i.settings.windowMargin+"px)",visibility:"hidden",position:"fixed",top:i.settings.windowMargin,left:0,"z-index":99999,"pointer-events":"none"},i.refreshSettings=function(){i.css.required["max-height"]="calc(100% - "+2*i.settings.windowMargin+"px)",i.css.required.top=i.settings.windowMargin},i.isStatic=function(){return!(!i.settings.staticPreview&&void 0!=i.settings.mouse)},i.arrayContains=function(e,i){return t.inArray(e,i)>-1};var r=function(t){var e=t.offset();return{top:e.top-i.windowScrollTop,left:e.left-i.windowScrollLeft,offset:e,margin:t.width()+i.settings.triggerMargin}},n=function(t,e){var r=e/t*100,n=t/100*(r=r>100?100:r)-i.store.adjustedHeight/100*r;return i.current.css("max-height",t-(t-i.store.adjustedHeight)+"px"),n<i.settings.windowMargin?i.settings.windowMargin:n},o=function(){if(void 0==i.current)return!1;i.windowScrollTop=t(window).scrollTop(),i.windowScrollLeft=t(window).scrollLeft(),i.isStatic()?void 0==i.store.offset&&(i.store.offset=r(i.last.trigger)):void 0==i.store.offset?i.store.offset={top:i.settings.mouse.pageY-i.windowScrollTop,left:i.settings.mouse.pageX-i.windowScrollLeft,margin:i.settings.triggerMargin}:i.store.offset.left=i.settings.mouse.pageX-i.windowScrollLeft;var e;if(i.windowWidthH>i.windowWidth-i.store.offset.left?(e=Math.floor(i.windowWidth-i.store.offset.left+i.settings.triggerMargin),i.current.css({left:"",right:e+"px","max-width":i.windowWidth-e-i.settings.windowMargin+"px"})):(e=Math.floor(i.store.offset.left+i.store.offset.margin),i.current.css({left:e+"px",right:"","max-width":i.windowWidth-e-i.settings.windowMargin+"px"})),void 0==i.store.currentTop){var o=i.windowHeight-2*i.settings.windowMargin;i.store.adjustedHeight=i.current.height(),i.store.adjustedHeight<o&&(i.store.currentTop=n(o,i.store.offset.top),i.current.css("top",i.store.currentTop+"px"))}i.current.css("visibility","visible"),i.visible=!0},s=function(e){if(!1===e){var r=t("body").find("#video-preview, #image-preview");return r.length>0&&r.remove(),i.visible=!1,i.current=i.last.src=void 0,i.store={adjustedHeight:0,currentHeight:0,currentWidth:0,currentTop:void 0},!1}var n,o;if(n=i.last.trigger.data("preview"),!1!==n&&void 0!==n?i.last.src=i.last.trigger.data("preview"):"undefined"!==_typeof(o=i.last.trigger.attr(i.last.trigger.is("img")?"src":"href"))&&!1!==o&&(i.last.src=o),void 0==i.last.src)return!1;if(i.last.ext=i.last.src.split(".").pop().toLowerCase(),i.arrayContains(i.last.ext,i.settings.extensions.images)){null===i.loading&&(t(i).trigger("loadChange",!0),i.loading=!0);var s=new Image;s.orig=i.last.src,t(s).on("load",function(e){if(!i.visible){if(e.currentTarget.orig==i.last.src){var r=t("<img>",{id:"image-preview",src:s.src}).appendTo(t("body"));i.current=r,i.current.on("load",function(){i.getDimensions()}),i.current.css(i.css.required),void 0!==i.settings.css&&i.current.css(i.settings.css),null!==i.loading&&(t(i).trigger("loadChange",!1),i.loading=null),t(i).trigger("loaded",{itemType:0,element:r,source:e.currentTarget.orig,dimensions:{width:e.currentTarget.width,height:e.currentTarget.height}})}return!0}}),s.src=i.last.src}if(i.arrayContains(i.last.ext,i.settings.extensions.videos)){null===i.loading&&(t(i).trigger("loadChange",!0),i.loading=!0);var g=t("<video/>",{id:"video-preview",controls:"",loop:"",muted:"",autoplay:""}).prependTo(t("body")),a=t("<source>",{src:""}).prependTo(g);i.current=g,g.attr("data-orig",i.last.src),a.attr("src",i.last.src),g.css(i.css.required),void 0!==i.settings.css&&g.css(i.settings.css),g[0].muted=!0,g[0].load(),i.waitForVideo(g)}};i.waitForVideo=function(e){!function r(){return void 0!=i.current&&e.data("orig")===i.last.src&&(e.prop("readyState")>=3&&e.width()>0&&e.height()>0?(i.currentWidth=e.width(),i.store.currentHeight=e.height(),o(i.isStatic()),e[0].play(),t(i).trigger("loadChange",!1),null!==i.loading&&(t(i).trigger("loadChange",!1),i.loading=null),t(i).trigger("loaded",{itemType:1,element:e,source:e.data("orig"),dimensions:{width:e.width(),height:e.height()}}),!0):void setTimeout(r,150))}()},i.getDimensions=function(){!function t(){return void 0!=i.current&&(i.current.width()>0&&i.current.height()>0?(i.currentWidth=i.current.width(),i.store.currentHeight=i.current.height(),o(i.isStatic()),!0):void setTimeout(t,150))}()};var g=function(){i.windowWidth=t(window).width(),i.windowHeight=t(window).height(),i.windowWidthH=t(window).width()/2};return function(){if(1>i.settings.elements.length)return!1;g(),t.each(i.settings.elements,function(e,r){t(document).off("mouseenter",r).on("mouseenter",r,function(e){i.last.trigger=t(e.currentTarget),i.timer=setTimeout(function(){if(i.visible)return!0;s()},i.settings.hoverDelay)}),t(document).off("mouseleave",r).on("mouseleave",r,function(e){null!==i.loading&&(t(i).trigger("loadChange",!1),i.loading=null),clearTimeout(i.timer),s(!1)}),t(window).off("resize").on("resize",function(){void 0!==i.resizeTimer&&clearTimeout(i.resizeTimer),i.resizeTimer=setTimeout(function(){g()},250)}),i.settings.staticPreview||t(document).off("mousemove",r).on("mousemove",r,function(t){i.settings.mouse=t,i.visible&&o()})})}(),i}}(jQuery);